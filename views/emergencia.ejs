<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Serviços de Emergência - Protege+</title>
  <link rel="stylesheet" href="/css/emergencia.css" />
  <link rel="icon" href="/logo.png" type="image/png">
  <script src="/js/api.js"></script>
</head>
<body>
  <div class="emergency-container">
    <!-- Cabeçalho (PROTEGE + e Logout) -->
    <h1 class="app-title">PROTEGE +</h1>
    <div class="logout-area" onclick="logout()">
      <span class="logout-text">Logout</span>
    </div>

    <!-- Barra de pesquisa -->
    <div class="search-wrap">
      <input id="search" type="search" placeholder="Pesquisar" />
    </div>

    <!-- Lista/Seção de serviços de emergência (cards) -->
    <section class="emergency-section" id="services-list">Carregando serviços...</section>
  </div>

  <script>
    async function loadTelefones() {
      const container = document.getElementById('services-list');
      container.innerHTML = 'Carregando...';
      const resp = await getTelefonesUteis();
      if (!resp.success) {
        container.innerHTML = '<div>Erro ao carregar telefones</div>';
        return;
      }
      const telefones = (resp.data && resp.data.telefones) || [];
      if (!telefones || telefones.length === 0) {
        container.innerHTML = '<div>Nenhum serviço encontrado</div>';
        return;
      }
      container.innerHTML = '';
      telefones.forEach(t => {
        const art = document.createElement('article');
        art.className = 'card-service';
        art.innerHTML = `
          <div class="card-left">
            <div class="card-icon"></div>
            <div class="card-title">${t.unidade || 'Serviço'}</div>
          </div>
          <div class="card-right">
            <div class="card-phone">${t.numero || '—'}</div>
            <div class="card-distance">—</div>
          </div>`;
        container.appendChild(art);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadTelefones();
    });

    // Pesquisa cliente simples (filtra por título ou telefone)
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('search');

      input.addEventListener('input', () => {
        const q = input.value.trim().toLowerCase();
        const list = Array.from(document.querySelectorAll('.card-service'));
        list.forEach(card => {
          const titleEl = card.querySelector('.card-title');
          const phoneEl = card.querySelector('.card-phone');
          const title = titleEl ? titleEl.textContent.toLowerCase() : '';
          const phone = phoneEl ? phoneEl.textContent.toLowerCase() : '';
          const match = q === '' || title.includes(q) || phone.includes(q);
          card.style.display = match ? 'flex' : 'none';
        });
      });
    });
</body>
</html>
