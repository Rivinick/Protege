<%- include("./head.ejs"); %>

<div class="container">
    <div class="jumbotron">
        <h1 class="display-4">Gestão de Contatos</h1>
        <p class="lead">Diretório de profissionais e telefones de emergência.</p>
    </div>
</div>

<body>
    <div class="container">
        
        <div class="d-flex justify-content-end mb-3 d-print-none">
            <a class="btn btn-success btn-lg" href="/inserirPessoa">
                <i class="fas fa-plus"></i> Cadastrar Nova Pessoa
            </a>
        </div>

        <div class="row">
            <% 
            let ultimoId = 0;
            // Loop principal
            for (let i = 0; i < dados.length; i++) { 
                const registro = dados[i];
                
                // SE FOR UMA NOVA PESSOA (ID diferente do anterior)
                if (registro.IdPessoa !== ultimoId) {
                    // Fecha o cartão anterior (se não for o primeiro)
                    if (ultimoId !== 0) { %>
                                </tbody>
                            </table>
                        </div> </div> </div> <% } 
                
                ultimoId = registro.IdPessoa;
                %>

                <div class="col-12 col-md-6 col-lg-6 mb-4">
                    <div class="card card-pessoa h-100">
                        <div class="card-header-red">
                            <h4 class="m-0"><%= registro.Nome %></h4>
                            <small><%= registro.Cargo %> - <%= registro.Empresa %></small>
                        </div>
                        <div class="card-body">
                            <div class="dados-mestre mb-3">
                                <p><strong>CPF:</strong> <%= registro.CPF %></p>
                                <p><strong>Email:</strong> <%= registro.Email %></p>
                                <div class="text-right">
                                    <a class="btn btn-sm btn-outline-danger" onclick="return confirm('Tem certeza? Isso apagará a pessoa e todos os telefones.');" href="/deletaTodos/<%= registro.IdPessoa %>">
                                        Excluir Pessoa Completa
                                    </a>
                                </div>
                            </div>

                            <hr>
                            <h6 class="text-danger">Contatos Registrados:</h6>

                            <table class="table table-sm table-borderless">
                                <thead>
                                    <tr class="text-secondary">
                                        <th>Número</th>
                                        <th>Unidade</th>
                                        <th class="text-right">Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
            <% } // Fim do IF de Nova Pessoa %>

            <tr>
                <td><%= registro.Numero %></td>
                <td><%= registro.UnidadedaSaude %></td>
                <td class="text-right action-buttons">
                    <a class="btn btn-sm btn-danger" href="/inserirTelefone/<%= registro.IdPessoa %>/<%= registro.IdTelefone %>" title="Incluir Novo">+</a>
                    <a class="btn btn-sm btn-danger" href="/editar/<%= registro.IdPessoa %>/<%= registro.IdTelefone %>" title="Editar">✎</a>
                    <a class="btn btn-sm btn-danger" href="/delete/<%= registro.IdPessoa %>/<%= registro.IdTelefone %>" title="Deletar">X</a>
                </td>
            </tr>

            <% } // Fim do Loop For %>

            <% if (dados.length > 0) { %>
                        </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            <% } %>
        </div> </div>
</body>
<footer>
    <p>&copy; 2025 - Sistema Protege</p>
</footer>
</html>