<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Diagnósticos e Doenças - Protege+</title>
  <link rel="stylesheet" href="/css/sintomas.css" />
  <script src="/js/api.js"></script>
</head>
<body>
  <div class="diagnostics-container">
    <h1 class="app-title">Diagnósticos e Doenças</h1>
    <div class="logout-area" onclick="logout()"><span class="logout-text">Logout</span></div>

    <div id="items" style="margin-top:16px">Carregando itens...</div>
  </div>

  <script>
    // Show items for the Diagnósticos group directly (prefer id=7)
    async function loadDiagnosticos() {
      const itemsEl = document.getElementById('items');
      itemsEl.innerHTML = 'Carregando itens...';

      const gruposResp = await getGruposCiap();
      if (!gruposResp.success) {
        itemsEl.innerHTML = '<div>Erro ao carregar grupos</div>';
        return;
      }
      const grupos = (gruposResp.data && gruposResp.data.grupos) || [];

      // prefer explicit id 7, fallback to name match
      let target = grupos.find(g => g.id === 7) || grupos.find(g => /diagnósticos|diagnosticos|doenças/i.test(g.componente));
      if (!target) {
        itemsEl.innerHTML = '<div>Grupo de Diagnósticos não encontrado</div>';
        return;
      }

      const resp2 = await getItensCiap(target.id);
      if (!resp2.success) {
        itemsEl.innerHTML = '<div>Erro ao carregar itens</div>';
        return;
      }
      const items = (resp2.data && resp2.data.itens) || [];
      if (items.length === 0) {
        itemsEl.innerHTML = '<div>Nenhum item encontrado</div>';
        return;
      }
      // Make each item clickable, navigating to the detalhe page
      itemsEl.innerHTML = '<ul>' + items.map(i => `\n        <li><a class="ciap-link" href="/sintomas/detalhes/${i.codigo}">${i.codigo} — ${i.nome}</a></li>`).join('') + '\n      </ul>';
    }

    document.addEventListener('DOMContentLoaded', loadDiagnosticos);
  </script>
</body>
</html>